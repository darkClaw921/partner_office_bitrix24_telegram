## Описание
Телеграм-бот на `aiogram 3`, который собирает номера телефонов и коды партнёров и сохраняет их в SQLite. Конфигурация хранится в `.env`, логирование реализовано через `loguru`.

## Требования
- Python 3.12+
- Установленный `pip`/`uv`
- Токен Telegram-бота от [@BotFather](https://t.me/BotFather)

## Установка
```bash
python -m venv .venv
source .venv/bin/activate
pip install -e .
```

## Настройка окружения
1. Скопируйте `.env.example` в `.env`.
2. Заполните `BOT_TOKEN`. При необходимости укажите свой путь `DATABASE_PATH`, уровень логирования `LOG_LEVEL`, а также `BITRIX_WEBHOOK` (формат `https://<домен>.bitrix24.ru/rest/<user>/<token>`).

## Запуск бота
```bash
python main.py
```

При старте бот:
- инициализирует SQLite и создаёт таблицу `partner_requests`;
- ищет контакт в Bitrix24 по номеру с типом `PARTNER`, подтягивает поле `UF_CRM_1763459353553` и сверяет код;
- запускает FSM-сценарий (`/start` → телефон → код партнёра);
- после авторизации показывает инлайн-кнопки статистики и по запросу считает сделки из Bitrix24 (сегодня / неделя / всё время) по ответственному контакту;
- пишет логи в stdout и `logs/bot.log`.

## Структура
Подробности смотрите в `architecture.md`. Ключевые элементы:
- `app/config.py` — загрузка настроек.
- `app/bot/handlers.py` — сценарий общения с пользователем, проверка контакта Bitrix24 и кода партнёра.
- `app/services/stats.py` — агрегация статистики сделок (статусы, суммы) по ответственному в Bitrix24.
- `app/db/database.py` — слой доступа к данным, хранит ID контакта Bitrix24.
- `app/utils/validators.py` — валидация телефона и кода партнёра.
